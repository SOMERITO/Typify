<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typify Cloud</title>
    <style>
        :root { --p:#4f46e5; --s:#ec4899; --bg:#f8fafc; --t:#0f172a; --ok:#10b981; --err:#ef4444; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--t); margin:0; padding:40px 20px; display:flex; flex-direction:column; align-items:center; min-height:100vh; }
        .loading-overlay { position:fixed; inset:0; background:rgba(255,255,255,0.9); z-index:2000; display:flex; flex-direction:column; align-items:center; justify-content:center; transition: 0.4s; }
        .loading-overlay.hidden { opacity:0; visibility:hidden; }
        .spinner { width:45px; height:45px; border:4px solid #e2e8f0; border-top-color:var(--p); border-radius:50%; animation: spin 1s linear infinite; margin-bottom:15px; }
        @keyframes spin { to { transform:rotate(360deg); } }
        .header { width:100%; max-width:800px; text-align:center; margin-bottom:30px; }
        h1 { margin:0 0 10px; background:linear-gradient(to right, var(--p), var(--s)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; font-size:2.4rem; font-weight:800; }
        .status { font-size:0.85rem; font-weight:700; padding:5px 15px; border-radius:20px; display:inline-flex; align-items:center; gap:6px; background:#e2e8f0; }
        .status.active { background:#dcfce7; color:var(--ok); }
        .status.local { background:#fee2e2; color:var(--err); }
        .search-area { width:100%; max-width:700px; display:flex; gap:12px; margin-top:25px; }
        input { flex:1; padding:16px 20px; border-radius:18px; border:2px solid transparent; background:white; box-shadow:0 10px 20px -5px rgba(0,0,0,0.1); font-size:1.1rem; outline:none; transition:0.3s; }
        input:focus { border-color:var(--p); }
        .btn-x { width:55px; height:55px; border-radius:15px; border:2px solid var(--err); background:white; color:var(--err); cursor:pointer; font-weight:800; display:flex; align-items:center; justify-content:center; opacity:0; transform:scale(0.5); transition:0.3s; }
        .btn-x.show { opacity:1; transform:scale(1); }
        .chips { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:20px; }
        .chip { background:white; border:1px solid #e2e8f0; padding:7px 15px; border-radius:20px; cursor:pointer; font-size:0.9rem; font-weight:600; transition:0.2s; }
        .chip.active { background:var(--p)!important; color:white!important; }
        #results { width:100%; max-width:800px; display:grid; gap:15px; margin-top:30px; padding-bottom:100px; }
        .card { background:white; padding:20px; border-radius:18px; box-shadow:0 4px 6px -1px rgba(0,0,0,0.05); position:relative; overflow:hidden; border-left:5px solid var(--p); }
        .card .titulo { font-weight:800; font-size:1.1rem; margin-bottom:12px; }
        .card .badge { display:inline-block; font-size:0.7rem; font-weight:800; padding:3px 8px; border-radius:5px; text-transform:uppercase; margin-bottom:8px; }
        .box { background:#f1f5f9; border-radius:10px; padding:12px; cursor:pointer; border:1px solid #cbd5e1; transition:0.2s; position:relative; }
        .box:hover { border-color:var(--p); background:white; }
        .box pre { margin:0; font-family:inherit; white-space:pre-wrap; color:#334155; line-height:1.5; font-size:0.95rem; }
        .ruta { font-family:monospace; font-size:0.8rem; color:#64748b; margin-top:12px; }
        .btns { position:absolute; top:15px; right:15px; display:flex; gap:5px; }
        .btn-a { background:#f1f5f9; border:none; padding:5px; border-radius:5px; cursor:pointer; font-size:1.1rem; }
        .fab { position:fixed; bottom:30px; right:30px; width:60px; height:60px; background:linear-gradient(135deg, var(--p), var(--s)); border-radius:50%; border:none; color:white; font-size:30px; cursor:pointer; box-shadow:0 8px 15px rgba(79,70,229,0.3); z-index:100; transition:0.3s; }
        .overlay { position:fixed; inset:0; background:rgba(15,23,42,0.6); backdrop-filter:blur(3px); display:none; align-items:center; justify-content:center; z-index:200; }
        .overlay.active { display:flex; }
        .modal { background:white; width:90%; max-width:500px; padding:25px; border-radius:20px; }
        .row { margin-bottom:15px; }
        .row label { display:block; margin-bottom:5px; font-weight:700; font-size:0.85rem; color:#475569; }
        .row input, .row textarea { width:100%; padding:10px; border:2px solid #e2e8f0; border-radius:10px; box-sizing:border-box; font-family:inherit; }
        #toast { visibility:hidden; background:#0f172a; color:white; padding:12px 25px; border-radius:50px; position:fixed; bottom:40px; left:50%; transform:translateX(-50%); transition:0.3s; z-index:3000; }
        #toast.show { visibility:visible; bottom:50px; }
    </style>
</head>
<body>
    <div id="loader" class="loading-overlay"><div class="spinner"></div><h3>Sincronizando Typify Cloud...</h3></div>
    <div class="header">
        <h1>Typify</h1>
        <div id="status" class="status">Cargando datos...</div>
        <div class="search-area">
            <input type="text" id="q" placeholder="Buscar tipificaci√≥n..." autocomplete="off">
            <button id="bx" class="btn-x">‚úï</button>
        </div>
        <div id="chips" class="chips"></div>
    </div>
    <div id="results"></div>
    <button class="fab" onclick="modal(-1)">+</button>
    <div id="m" class="overlay">
        <div class="modal">
            <h2 id="mt" style="margin:0 0 20px; color:var(--p);">Nuevo Registro</h2>
            <div style="display:flex; gap:10px;">
                <div class="row" style="flex:1;"><label>Categor√≠a</label><input id="ic" placeholder="Ej: PASOS"></div>
                <div class="row" style="flex:2;"><label>T√≠tulo</label><input id="it"></div>
            </div>
            <div class="row"><label>Contenido</label><textarea id="id" rows="5"></textarea></div>
            <div class="row"><label>Ruta</label><input id="ir"></div>
            <div style="display:flex; justify-content:flex-end; gap:10px;">
                <button onclick="modal()" style="border:none; background:none; cursor:pointer; font-weight:700; color:#64748b;">Cancelar</button>
                <button onclick="save()" style="border:none; background:var(--p); color:white; padding:10px 20px; border-radius:10px; cursor:pointer; font-weight:700;">Guardar</button>
            </div>
        </div>
    </div>
    <div id="toast">Copiado al portapapeles</div>
    <script>
        const BID = '69680821ae596e708fdcc510';
        const KEY = '$2a$10$rbQNmKHZB95qMFO9kbzxwe3g8vO70vkKhSX7NrbuvZFYShj7duOOi';
        let db = [], ed = -1, fil = "TODOS";
        const pal = [{bg:'#e0e7ff',t:'#4338ca'},{bg:'#dcfce7',t:'#15803d'},{bg:'#ffedd5',t:'#c2410c'},{bg:'#fee2e2',t:'#b91c1c'},{bg:'#fae8ff',t:'#a21caf'},{bg:'#ccfbf1',t:'#0f766e'},{bg:'#fef9c3',t:'#a16207'},{bg:'#f3e8ff',t:'#7e22ce'},{bg:'#e0f2fe',t:'#0369a1'},{bg:'#ffe4e6',t:'#be123c'},{bg:'#f1f5f9',t:'#475569'}];

        async function init() {
            const timeout = setTimeout(() => { if(db.length===0) hideLoader("‚ö†Ô∏è Modo Local"); }, 3500);
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BID}/latest`, { headers: { 'X-Master-Key': KEY, 'X-Bin-Meta': false } });
                db = await res.json();
                clearTimeout(timeout);
                hideLoader("‚òÅÔ∏è Nube Activa", true);
            } catch {
                hideLoader("‚ö†Ô∏è Modo Local");
                db = JSON.parse(localStorage.getItem('ty_db')) || [];
            }
            render();
        }

        function hideLoader(txt, ok) {
            document.getElementById('loader').classList.add('hidden');
            const s = document.getElementById('status');
            s.innerText = txt;
            s.className = `status ${ok ? 'active' : 'local'}`;
        }

        async function sync() {
            localStorage.setItem('ty_db', JSON.stringify(db));
            try {
                await fetch(`https://api.jsonbin.io/v3/b/${BID}`, { method: 'PUT', headers: { 'Content-Type': 'application/json', 'X-Master-Key': KEY }, body: JSON.stringify(db) });
            } catch { console.log("Sync error"); }
        }

        function getColor(t){ if(!t)return pal[10]; let s=0; for(let i=0;i<t.length;i++)s+=t.charCodeAt(i); return pal[s%pal.length]; }

        function render() {
            const area = document.getElementById('chips'); area.innerHTML = "";
            const cats = ["TODOS", ...new Set(db.map(x=>x.clasificacion).filter(Boolean))].sort();
            cats.forEach(c => {
                const b = document.createElement('button'); b.className = `chip ${fil===c?'active':''}`;
                b.innerText = c; b.onclick = () => { fil = c; render(); };
                area.appendChild(b);
            });
            const res = document.getElementById('results'); res.innerHTML = "";
            const q = document.getElementById('q').value.toLowerCase();
            db.map((x,i)=>({...x, idx:i})).filter(x => (x.titulo.toLowerCase().includes(q) || x.descripcion.toLowerCase().includes(q)) && (fil==="TODOS" || x.clasificacion===fil)).forEach(item => {
                const c = getColor(item.clasificacion);
                const d = document.createElement('div'); d.className = 'card'; d.style.borderLeftColor = c.t;
                d.innerHTML = `<div class="btns"><button class="btn-a" onclick="modal(${item.idx})">‚úèÔ∏è</button><button class="btn-a" onclick="del(${item.idx})">üóëÔ∏è</button></div>${item.clasificacion?`<span class="badge" style="background:${c.bg};color:${c.t}">${item.clasificacion}</span>`:''}<div class="titulo">${item.titulo}</div><div class="box" onclick="copy(${item.idx})"><pre>${item.descripcion}</pre></div><div class="ruta">${item.ruta||''}</div>`;
                res.appendChild(d);
            });
        }

        function copy(i) { navigator.clipboard.writeText(db[i].descripcion); const t=document.getElementById('toast'); t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2000); }
        function modal(i) { ed=i; document.getElementById('m').classList.toggle('active'); if(i===-1){ document.getElementById('mt').innerText="Nuevo"; document.getElementById('ic').value=document.getElementById('it').value=document.getElementById('id').value=document.getElementById('ir').value=""; } else if(i>=0){ const x=db[i]; document.getElementById('mt').innerText="Editar"; document.getElementById('ic').value=x.clasificacion||""; document.getElementById('it').value=x.titulo; document.getElementById('id').value=x.descripcion; document.getElementById('ir').value=x.ruta||""; } }
        async function save() { const o = { clasificacion: document.getElementById('ic').value.trim().toUpperCase(), titulo: document.getElementById('it').value.trim(), descripcion: document.getElementById('id').value, ruta: document.getElementById('ir').value.trim() }; if(!o.titulo) return; if(ed===-1) db.unshift(o); else db[ed]=o; await sync(); modal(); render(); }
        async function del(i) { if(confirm("¬øEliminar?")){ db.splice(i,1); await sync(); render(); } }
        document.getElementById('q').addEventListener('input', e => { document.getElementById('bx').classList.toggle('show', e.target.value.length>0); render(); });
        document.getElementById('bx').onclick = () => { document.getElementById('q').value=""; document.getElementById('bx').classList.remove('show'); render(); };
        window.onload = init;
    </script>
</body>
</html>
