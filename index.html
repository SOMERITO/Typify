<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typify Pro (Aesthetic)</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* =========================================
           ESTILOS PREMIUM (v40.0 - Glass & Glow)
           ========================================= */
        :root {
            --primary: #6366f1;
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --bg-gradient: linear-gradient(to bottom right, #f0f9ff, #e0e7ff);
            --text-main: #1e293b;
            --text-sec: #64748b;
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow-soft: 0 10px 40px -10px rgba(0,0,0,0.08);
            --shadow-hover: 0 20px 50px -12px rgba(79, 70, 229, 0.15);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-main);
            margin: 0;
            padding: 60px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background-attachment: fixed; /* Fondo fijo */
        }

        /* --- FONDO DECORATIVO --- */
        body::before {
            content: ''; position: fixed; top: -100px; left: -100px; width: 500px; height: 500px;
            background: radial-gradient(circle, rgba(99,102,241,0.15) 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%; z-index: -1; pointer-events: none;
        }

        /* --- ANIMACIONES --- */
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseGlow { 0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(99, 102, 241, 0); } 100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); } }

        /* --- HEADER --- */
        .header-container { 
            width: 100%; max-width: 750px; text-align: center; margin-bottom: 50px; 
            animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        h1 { 
            margin: 0 0 10px 0; 
            font-size: 3rem; font-weight: 800; letter-spacing: -0.03em;
            background: var(--primary-gradient);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
            filter: drop-shadow(0 2px 10px rgba(99, 102, 241, 0.2));
        }

        /* Status Pill */
        .status-pill {
            display: inline-flex; align-items: center; gap: 8px;
            font-size: 0.85rem; font-weight: 600; color: var(--text-sec);
            background: rgba(255,255,255,0.8); backdrop-filter: blur(8px);
            padding: 8px 16px; border-radius: 50px;
            border: 1px solid rgba(255,255,255,0.5);
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            margin-bottom: 35px;
        }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: #ccc; }
        .status-pill.active .dot { background: #10b981; animation: pulseGlow 2s infinite; }
        .status-pill.error .dot { background: #ef4444; }

        /* --- BUSCADOR FLOTANTE --- */
        .search-wrapper { position: relative; width: 100%; max-width: 650px; margin: 0 auto; z-index: 10; }
        
        .search-input {
            width: 100%; padding: 20px 50px 20px 55px; font-size: 1.15rem;
            border: none; border-radius: 24px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            color: var(--text-main); font-family: inherit; font-weight: 500;
            box-shadow: 0 15px 35px -5px rgba(0,0,0,0.08), 0 5px 15px -5px rgba(0,0,0,0.04);
            transition: all 0.3s ease;
        }
        .search-input:focus { 
            transform: translateY(-2px); 
            box-shadow: 0 20px 40px -5px rgba(99, 102, 241, 0.15); 
            outline: none; 
        }
        .search-icon { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: #94a3b8; pointer-events: none; transition:0.3s; }
        .search-input:focus + .search-icon { color: var(--primary); }

        .btn-clear {
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%) scale(0.8);
            width: 30px; height: 30px; border-radius: 50%; border: none; background: #f1f5f9;
            color: #64748b; cursor: pointer; display: flex; align-items: center; justify-content: center;
            opacity: 0; visibility: hidden; transition: 0.2s;
        }
        .btn-clear.visible { opacity: 1; visibility: visible; transform: translateY(-50%) scale(1); }
        .btn-clear:hover { background: #fee2e2; color: #ef4444; }

        /* --- TAGS (Chips) --- */
        .chips-container { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-top: 30px; }
        .chip {
            background: rgba(255,255,255,0.6); border: 1px solid rgba(255,255,255,0.5);
            color: var(--text-sec); padding: 8px 20px; border-radius: 100px;
            font-size: 0.9rem; font-weight: 600; cursor: pointer;
            transition: 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .chip:hover { background: white; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); color: var(--primary); }
        .chip.active { 
            background: var(--text-main); color: white; border-color: transparent;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2); transform: scale(1.05);
        }

        /* --- CARDS --- */
        #results { width: 100%; max-width: 800px; display: grid; gap: 24px; padding-bottom: 120px; }
        
        .card {
            background: var(--card-bg); border-radius: 24px;
            padding: 30px; position: relative; overflow: hidden;
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(255,255,255,0.6);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0; animation: slideUp 0.5s forwards;
        }
        .card:hover { 
            transform: translateY(-5px) scale(1.01); 
            box-shadow: var(--shadow-hover);
        }

        /* Header de la tarjeta */
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        
        .badge { 
            display: inline-block; font-size: 0.7rem; font-weight: 800; 
            padding: 6px 12px; border-radius: 8px; text-transform: uppercase; letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        .card-title { font-size: 1.35rem; font-weight: 700; color: #0f172a; letter-spacing: -0.01em; }

        /* Botones de acción (ocultos hasta hover) */
        .actions { display: flex; gap: 8px; opacity: 0; transform: translateX(10px); transition: 0.3s; }
        .card:hover .actions { opacity: 1; transform: translateX(0); }
        
        .icon-btn {
            width: 36px; height: 36px; border-radius: 12px; border: none; background: #f8fafc;
            color: #94a3b8; cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .icon-btn:hover { background: var(--primary); color: white; transform: rotate(10deg); }
        .icon-btn.del:hover { background: #ef4444; color: white; }

        /* Caja de Descripción (Interactiva) */
        .desc-box {
            background: #f8fafc; border: 2px dashed #cbd5e1; border-radius: 16px;
            padding: 20px; margin-bottom: 16px; cursor: pointer; position: relative;
            transition: all 0.3s ease;
        }
        .desc-box:hover { 
            background: #eef2ff; border-color: var(--primary); border-style: solid;
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.1);
        }
        .desc-box:active { transform: scale(0.98); }

        .desc-text { 
            font-size: 1.05rem; line-height: 1.6; color: #334155; 
            white-space: pre-wrap; margin: 0; font-family: inherit; pointer-events: none;
        }

        /* Tooltip flotante */
        .tooltip-copy {
            position: absolute; top: -12px; right: 20px;
            background: var(--primary); color: white;
            font-size: 0.75rem; font-weight: 700; padding: 4px 12px; border-radius: 20px;
            opacity: 0; transform: translateY(10px); transition: 0.3s;
            box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3); pointer-events: none;
        }
        .desc-box:hover .tooltip-copy { opacity: 1; transform: translateY(0); }

        .route { 
            font-family: 'Courier New', monospace; font-size: 0.85rem; color: #94a3b8; 
            display: flex; align-items: center; gap: 8px; font-weight: 600;
        }

        /* --- FAB BUTTON --- */
        .fab {
            position: fixed; bottom: 40px; right: 40px; 
            width: 65px; height: 65px; border-radius: 50%;
            background: var(--text-main); color: white; border: none;
            box-shadow: 0 15px 30px rgba(0,0,0,0.25); cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 100;
        }
        .fab:hover { transform: scale(1.1) rotate(90deg); background: var(--primary); }

        /* --- TOAST --- */
        #toast {
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%) translateY(50px);
            background: #1e293b; color: white; padding: 12px 30px; border-radius: 50px;
            font-weight: 600; box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            opacity: 0; visibility: hidden; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000; display: flex; align-items: center; gap: 10px;
        }
        #toast.visible { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }

        /* --- MODAL --- */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.3); backdrop-filter: blur(8px);
            display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; transition: 0.3s; z-index: 200;
        }
        .overlay.active { opacity: 1; visibility: visible; }
        
        .modal {
            background: white; width: 90%; max-width: 500px; padding: 40px;
            border-radius: 30px; box-shadow: 0 40px 80px -20px rgba(0,0,0,0.2);
            transform: scale(0.9); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .overlay.active .modal { transform: scale(1); }

        .input-group { margin-bottom: 20px; }
        .input-label { display: block; font-size: 0.85rem; font-weight: 700; color: #64748b; margin-bottom: 8px; text-transform: uppercase; }
        .input-field { 
            width: 100%; padding: 14px; border-radius: 12px; border: 2px solid #f1f5f9;
            font-family: inherit; font-size: 1rem; color: var(--text-main);
            background: #f8fafc; transition: 0.2s; box-sizing: border-box;
        }
        .input-field:focus { border-color: var(--primary); background: white; outline: none; }

        .modal-actions { display: flex; justify-content: flex-end; gap: 12px; margin-top: 30px; }
        .btn { padding: 12px 24px; border-radius: 12px; font-weight: 700; cursor: pointer; border: none; transition: 0.2s; }
        .btn-cancel { background: transparent; color: #94a3b8; }
        .btn-cancel:hover { background: #f1f5f9; color: var(--text-main); }
        .btn-confirm { background: var(--text-main); color: white; }
        .btn-confirm:hover { background: var(--primary); transform: translateY(-2px); box-shadow: 0 10px 20px -5px rgba(99, 102, 241, 0.4); }
        .btn-delete { background: #fee2e2; color: #ef4444; }
        .btn-delete:hover { background: #ef4444; color: white; }

        /* Loader */
        .loader { position: fixed; inset: 0; background: white; z-index: 2000; display: flex; justify-content: center; align-items: center; transition: 0.5s; }
        .loader.hidden { opacity: 0; pointer-events: none; }
    </style>
</head>
<body>

    <div id="loader" class="loader">
        <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="#6366f1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="animation:spin 1s linear infinite"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg>
    </div>

    <div class="header-container">
        <h1>Typify Pro</h1>
        
        <div id="statusEl" class="status-pill">
            <div class="dot"></div>
            <span id="statusTxt">Conectando...</span>
        </div>

        <div class="search-wrapper">
            <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            <input type="text" id="searchIn" class="search-input" placeholder="Buscar... (Presiona Ctrl + F)" autocomplete="off">
            <button id="clearBtn" class="btn-clear">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>

        <div id="chips" class="chips-container"></div>
    </div>

    <div id="results"></div>

    <button class="fab" onclick="modalOpen()">
        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
    </button>

    <div id="toast">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
        <span id="toastMsg">Copiado al portapapeles</span>
    </div>

    <div class="overlay" id="modalMain">
        <div class="modal">
            <h2 id="modalTitle" style="margin:0 0 30px 0; font-size:1.8rem;">Nueva Tipificación</h2>
            <div style="display:flex; gap:15px;">
                <div class="input-group" style="flex:1">
                    <label class="input-label">Clasificación</label>
                    <input id="inClass" class="input-field" placeholder="Ej: PASOS">
                </div>
                <div class="input-group" style="flex:2">
                    <label class="input-label">Título</label>
                    <input id="inTitle" class="input-field" placeholder="Título corto">
                </div>
            </div>
            <div class="input-group">
                <label class="input-label">Descripción</label>
                <textarea id="inDesc" class="input-field" rows="5" placeholder="El texto que necesitas copiar..."></textarea>
            </div>
            <div class="input-group">
                <label class="input-label">Ruta / Sistema</label>
                <input id="inRoute" class="input-field" placeholder="CRM > Opción...">
            </div>
            <div class="modal-actions">
                <button class="btn btn-cancel" onclick="modalClose()">Cancelar</button>
                <button id="btnSave" class="btn btn-confirm" onclick="saveData()">Guardar</button>
            </div>
        </div>
    </div>

    <div class="overlay" id="modalDel">
        <div class="modal" style="max-width:380px; text-align:center;">
            <div style="width:70px; height:70px; background:#fef2f2; color:#ef4444; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 20px;">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path></svg>
            </div>
            <h3 style="margin:0 0 10px 0; font-size:1.5rem;">¿Estás seguro?</h3>
            <p style="color:#64748b; margin:0 0 30px 0; line-height:1.5;">Esta acción eliminará el registro permanentemente.</p>
            <div class="modal-actions" style="justify-content:center;">
                <button class="btn btn-cancel" onclick="delClose()">No, cancelar</button>
                <button class="btn btn-delete" onclick="delConfirm()">Sí, eliminar</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIG
        const BIN_ID = '6968712543b1c97be93195f1'; 
        const MASTER_KEY = '$2a$10$7PwFegDVLzoS8bJTQPdA7.27bk7D4odCTFnynWW1NkB5H6.PBt.nm';

        // STATE
        let db = [];
        let editIdx = -1;
        let filtro = "TODOS";
        let deleteIdx = null;

        // DOM ELEMENTS
        const el = {
            loader: document.getElementById('loader'),
            status: document.getElementById('statusEl'),
            statusTxt: document.getElementById('statusTxt'),
            search: document.getElementById('searchIn'),
            clear: document.getElementById('clearBtn'),
            chips: document.getElementById('chips'),
            res: document.getElementById('results'),
            modal: document.getElementById('modalMain'),
            modalDel: document.getElementById('modalDel'),
            toast: document.getElementById('toast'),
            in: {
                c: document.getElementById('inClass'),
                t: document.getElementById('inTitle'),
                d: document.getElementById('inDesc'),
                r: document.getElementById('inRoute')
            },
            mTitle: document.getElementById('modalTitle'),
            btnSave: document.getElementById('btnSave')
        };

        // INIT
        window.onload = () => { el.search.focus(); init(); };

        async function init() {
            const t = setTimeout(() => { if(!db.length) { setStatus(false, "Modo Local"); db=localLoad(); el.loader.classList.add('hidden'); render(); }}, 5000);
            
            try {
                const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {headers:{'X-Master-Key':MASTER_KEY}});
                if(!r.ok) throw new Error();
                const d = await r.json();
                db = Array.isArray(d.record) ? d.record : [];
                setStatus(true, "Sincronizado");
                clearTimeout(t);
            } catch(e) {
                setStatus(false, "Desconectado");
                db = localLoad();
            }
            render();
            el.loader.classList.add('hidden');
        }

        // LOGIC
        function setStatus(ok, txt) {
            el.status.className = `status-pill ${ok?'active':'error'}`;
            el.statusTxt.innerText = txt;
        }
        function localLoad() { return JSON.parse(localStorage.getItem('typify_db')) || []; }
        
        async function sync() {
            el.loader.classList.remove('hidden');
            localStorage.setItem('typify_db', JSON.stringify(db));
            try {
                const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method:'PUT', headers:{'Content-Type':'application/json','X-Master-Key':MASTER_KEY}, body:JSON.stringify(db)
                });
                if(!r.ok) throw new Error();
                setStatus(true, "Guardado");
                toast("Cambios guardados exitosamente");
            } catch(e) {
                setStatus(false, "Error Guardado");
                alert("Error al subir a la nube. Se guardó localmente.");
            }
            el.loader.classList.add('hidden');
        }

        // RENDER
        const colors = [
            {bg:'#e0e7ff',t:'#4338ca'}, {bg:'#dcfce7',t:'#15803d'}, {bg:'#ffedd5',t:'#c2410c'},
            {bg:'#fee2e2',t:'#b91c1c'}, {bg:'#fae8ff',t:'#a21caf'}, {bg:'#ccfbf1',t:'#0f766e'},
            {bg:'#fef9c3',t:'#a16207'}, {bg:'#f3e8ff',t:'#7e22ce'}, {bg:'#e0f2fe',t:'#0369a1'}
        ];
        function getColor(s) { if(!s) return colors[0]; let h=0; for(let i=0;i<s.length;i++)h+=s.charCodeAt(i); return colors[h%colors.length]; }

        function render() {
            // Chips
            const cats = ["TODOS", ...new Set(db.map(x=>x.clasificacion).filter(Boolean))].sort();
            el.chips.innerHTML = cats.map(c => `<button class="chip ${filtro===c?'active':''}" onclick="setFilter('${c}')">${c==="TODOS"?"Todos":c}</button>`).join('');

            // Cards
            const q = el.search.value.toLowerCase();
            const list = db.map((x,i)=>({...x,i})).filter(x => (filtro==="TODOS"||x.clasificacion===filtro) && (x.titulo.toLowerCase().includes(q)||x.descripcion.toLowerCase().includes(q)));
            
            if(!list.length) { el.res.innerHTML = '<div style="text-align:center;color:#94a3b8;padding:50px;">Sin resultados</div>'; return; }

            el.res.innerHTML = list.map(x => {
                const c = getColor(x.clasificacion);
                return `
                <div class="card" style="animation-delay:${x.i*0.05}s">
                    <div class="card-header">
                        <div>
                            ${x.clasificacion?`<span class="badge" style="background:${c.bg};color:${c.t}">${x.clasificacion}</span>`:''}
                            <div class="card-title">${x.titulo}</div>
                        </div>
                        <div class="actions">
                            <button class="icon-btn" onclick="modalOpen(${x.i})"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button>
                            <button class="icon-btn del" onclick="delAsk(${x.i})"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>
                        </div>
                    </div>
                    <div class="desc-box" onclick="copy('${escapeHtml(x.descripcion)}')">
                        <div class="tooltip-copy">CLICK PARA COPIAR</div>
                        <pre class="desc-text">${x.descripcion}</pre>
                    </div>
                    <div class="route"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg> ${x.ruta||'General'}</div>
                </div>`;
            }).join('');
        }

        window.setFilter = c => { filtro = c; render(); };
        function escapeHtml(text) { return text.replace(/'/g, "\\'"); }

        // INTERACTIONS
        window.copy = (txt) => { navigator.clipboard.writeText(txt); toast("¡Copiado!"); };
        function toast(msg) { 
            document.getElementById('toastMsg').innerText = msg;
            el.toast.classList.add('visible'); 
            setTimeout(()=>el.toast.classList.remove('visible'), 2000); 
        }

        // MODALS
        window.modalOpen = (idx=-1) => {
            editIdx = idx;
            el.mTitle.innerText = idx===-1 ? "Nueva Tipificación" : "Editar Registro";
            el.btnSave.innerText = idx===-1 ? "Crear" : "Guardar Cambios";
            const d = idx===-1 ? {} : db[idx];
            el.in.c.value = d.clasificacion||""; el.in.t.value = d.titulo||"";
            el.in.d.value = d.descripcion||""; el.in.r.value = d.ruta||"";
            el.modal.classList.add('active'); setTimeout(()=>el.in.c.focus(), 100);
        };
        window.modalClose = () => el.modal.classList.remove('active');
        
        window.saveData = async () => {
            const obj = {
                clasificacion: el.in.c.value.trim().toUpperCase(),
                titulo: el.in.t.value.trim(),
                descripcion: el.in.d.value,
                ruta: el.in.r.value.trim()
            };
            if(!obj.titulo) return alert("Falta el título");
            
            editIdx===-1 ? db.unshift(obj) : db[editIdx] = obj;
            modalClose(); render(); await sync();
        };

        window.delAsk = (i) => { deleteIdx=i; el.modalDel.classList.add('active'); };
        window.delClose = () => el.modalDel.classList.remove('active');
        window.delConfirm = async () => { if(deleteIdx!==null){ db.splice(deleteIdx,1); delClose(); render(); await sync(); }};

        // EVENTS
        el.search.addEventListener('input', e => { el.clear.classList.toggle('visible', e.target.value.length>0); render(); });
        el.clear.onclick = () => { el.search.value=''; el.clear.classList.remove('visible'); el.search.focus(); render(); };
        document.addEventListener('keydown', e => {
            if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='f') { e.preventDefault(); el.search.focus(); el.search.select(); }
            if(e.key==='Escape') { modalClose(); delClose(); if(document.activeElement===el.search) el.clear.click(); }
        });
    </script>
</body>
</html>
